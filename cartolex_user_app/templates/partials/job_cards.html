<!-- Job Cards Partial for Jobs List Page -->
{% if jobs %}
    <div class="grid gap-4">
        {% for job in jobs %}
            <div class="esevioz-card esevioz-shadow rounded-lg esevioz-workflow-card-hover"
                 x-data="{ expanded: false }">
                <!-- Job Header -->
                <div class="px-6 py-4 rounded-t-lg">
                    <div class="flex items-start justify-between">
                        <!-- Left: Main Info (clickable to expand details) -->
                        <div class="flex-1 cursor-pointer"
                             @click="if (!expanded) {
                                       htmx.ajax('GET', `/workflows/jobs/{{ job.id }}/detail`, {
                                           target: `#job-${job.id}-detail`,
                                           swap: 'innerHTML'
                                       });
                                       expanded = true;
                                     } else {
                                       expanded = false;
                                       document.getElementById(`job-${job.id}-detail`).innerHTML = '';
                                     }">
                            <div class="flex items-center space-x-3 mb-2">
                                <h4 class="text-lg font-medium esevioz-text">{{ job.workflow_name or 'Unknown Workflow' }}</h4>

                                <!-- Status Badge with auto-refresh for active jobs -->
                                <div {% if job.status | is_active %}
                                         hx-get="/workflows/jobs/{{ job.id }}/status"
                                         hx-trigger="every 5s"
                                         hx-swap="outerHTML"
                                     {% endif %}>
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium {{ job.status | job_status_class }}">
                                        {% if job.status | is_active %}
                                            <svg class="animate-spin -ml-1 mr-1.5 h-3 w-3" fill="none" viewBox="0 0 24 24">
                                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                            </svg>
                                        {% endif %}
                                        {{ job.status | title }}
                                    </span>
                                </div>

                                <!-- Expand/Collapse Chevron -->
                                <svg class="w-5 h-5 esevioz-text opacity-50 transition-transform"
                                     :class="{ 'transform rotate-180': expanded }"
                                     fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </div>

                            <!-- Job ID -->
                            <p class="text-xs esevioz-text opacity-60 font-mono mb-2">{{ job.id }}</p>

                            <!-- Timestamps -->
                            <div class="flex items-center space-x-4 text-xs esevioz-text opacity-60">
                                {% if job.created_at %}
                                    <span>Created: {{ job.created_at }}</span>
                                {% endif %}
                                {% if job.started_at %}
                                    <span>• Started: {{ job.started_at }}</span>
                                {% endif %}
                                {% if job.completed_at %}
                                    <span>• Completed: {{ job.completed_at }}</span>
                                {% endif %}
                            </div>

                            <!-- Tags -->
                            {% if job.tags and job.tags|length > 0 %}
                            <div class="mt-2 flex flex-wrap gap-1">
                                {% for tag in job.tags %}
                                <span class="inline-flex items-center px-2 py-0.5 rounded text-xs esevioz-badge-info">
                                    <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
                                    </svg>
                                    {{ tag }}
                                </span>
                                {% endfor %}
                            </div>
                            {% endif %}

                            <!-- Error Preview (for failed jobs) -->
                            {% if job.error and job.status in ['failed', 'error'] %}
                            <div class="mt-2 p-2 esevioz-bg-vermilion-light border esevioz-border-vermilion rounded text-xs esevioz-text-vermilion-dark">
                                <strong>Error:</strong> {{ job.error | truncate(150) }}
                            </div>
                            {% endif %}
                        </div>

                        <!-- Right: Action Buttons -->
                        <div class="ml-4 flex flex-col items-end space-y-2">
                            <!-- View Results Button (for completed jobs) -->
                            {% if job.status | is_terminal %}
                            <a href="{{ url_for('workflows.job_results', job_id=job.id) }}"
                               class="inline-flex items-center px-4 py-2 text-sm font-medium rounded esevioz-btn-primary"
                               @click.stop>
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                </svg>
                                View Results
                                <svg class="ml-2 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </a>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Expandable Detail Panel -->
                <div :id="`job-${job.id}-detail`"
                     x-show="expanded"
                     x-collapse>
                    <!-- Detail content loads here via HTMX -->
                </div>
            </div>
        {% endfor %}
    </div>
{% else %}
    <!-- Empty State -->
    <div class="text-center py-12 esevioz-card rounded-lg">
        <svg class="mx-auto h-12 w-12 esevioz-text opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
        </svg>
        <h3 class="mt-2 text-sm font-medium esevioz-text">No jobs found</h3>
        <p class="mt-1 text-sm esevioz-text opacity-75">Try adjusting your filters or launch a workflow to create jobs.</p>
    </div>
{% endif %}
