<!-- Template using shared constants via filters -->
<div class="job-status"
     data-job-id="{{ job.id }}"
     data-job-status="{{ job.status }}">

    <div class="flex items-center justify-between">
        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium {{ job.status | job_status_class }}">
            {% if job.status | is_active %}
                <svg class="animate-spin -ml-1 mr-1.5 h-3 w-3" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
            {% endif %}
            {{ job.status | title }}
        </span>

        <div class="text-xs text-gray-500">
            {% if job.completed_at %}
                Completed: {{ job.completed_at }}
            {% elif job.started_at %}
                Started: {{ job.started_at }}
            {% endif %}
        </div>
    </div>

    {% if job.status | is_terminal %}
        <!-- Stop HTMX polling when job is finished -->
        <script>
            // Remove polling attributes when job is complete
            const element = document.querySelector('[data-job-id="{{ job.id }}"]');
            if (element) {
                element.removeAttribute('hx-get');
                element.removeAttribute('hx-trigger');
            }
        </script>
    {% endif %}

    {% if job.status == JOB_STATUSES.COMPLETED and job.result %}
        <div class="mt-3 p-3 bg-gray-50 rounded border">
            <h4 class="text-sm font-medium text-gray-900">Results</h4>
            <div class="mt-2 text-sm text-gray-700">
                {% for key, value in job.result.items() %}
                    <div><strong>{{ key }}:</strong> {{ value }}</div>
                {% endfor %}
            </div>
        </div>
    {% endif %}
</div>
