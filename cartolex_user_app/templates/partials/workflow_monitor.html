<!-- Enhanced Workflow Monitoring Section -->
<div class="esevioz-card esevioz-shadow rounded-lg">
    <div class="px-6 py-4 border-b esevioz-border-dominant">
        <div class="flex items-center justify-between">
            <div class="flex items-center">
                <svg class="w-5 h-5 esevioz-text mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                </svg>
                <h3 class="text-lg font-medium esevioz-text">Job Monitoring</h3>
            </div>
            <div class="flex items-center space-x-2">
                <button onclick="refreshJobs()" 
                        class="text-sm esevioz-text opacity-75 hover:opacity-100 p-1 rounded"
                        title="Refresh jobs">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                    </svg>
                </button>
                <a href="{{ url_for('workflows.list_jobs') }}" 
                   class="text-sm font-medium esevioz-btn-secondary px-3 py-1 rounded">
                    View All Jobs
                </a>
            </div>
        </div>
    </div>
    
    <div class="px-6 py-4" id="recent-jobs-container">
        <!-- Recent Jobs List -->
        <div hx-get="{{ url_for('workflows.list_jobs') }}?limit=5"
             hx-target="#recent-jobs-list"
             hx-trigger="load"
             hx-swap="innerHTML">
            <div id="recent-jobs-list">
                <!-- Loading placeholder -->
                <div class="flex items-center justify-center py-4">
                    <div class="animate-spin rounded-full h-6 w-6 border-b-2 esevioz-border-primary"></div>
                    <span class="ml-2 text-sm esevioz-text opacity-75">Loading recent jobs...</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Active Jobs Auto-Refresh -->
<div class="mt-4" 
     hx-get="{{ url_for('workflows.list_jobs') }}?status=running&limit=10"
     hx-target="#active-jobs-list"
     hx-trigger="every 5s"
     hx-swap="innerHTML">
    <div id="active-jobs-list">
        <!-- Active jobs will be loaded here -->
    </div>
</div>

<script>
function refreshJobs() {
    // Manually trigger HTMX refresh for recent jobs
    htmx.trigger('#recent-jobs-container', 'refresh');
    
    // Also refresh the active jobs
    htmx.trigger('#active-jobs-list', 'refresh');
}

// Custom HTMX event handlers for job monitoring
document.addEventListener('DOMContentLoaded', function() {
    // Listen for successful job submissions to refresh the monitoring
    document.body.addEventListener('htmx:afterSwap', function(evt) {
        if (evt.detail.target.id && evt.detail.target.id.includes('result')) {
            // A job result was updated, refresh the monitoring section
            setTimeout(refreshJobs, 1000);
        }
    });
});
</script>